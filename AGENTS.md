# Repository Guidelines

This is a TypeScript port of [subagent-py](https://github.com/christso/subagent-py).

## Project Structure & Module Organization
- `src/cli.ts`: Main CLI entry point using Commander.js for argument parsing
- `src/vscode/`: VS Code agent provisioning, dispatch, and workspace management
- `src/utils/`: Shared utility modules (file system operations, time utilities)
- `dist/`: Compiled JavaScript output (generated by TypeScript compiler)
- `src/vscode/subagent_template/`: Template files copied into each provisioned subagent workspace

## Build, Test, and Development Commands
- `pnpm install`: Install all dependencies
- `pnpm build`: Compile TypeScript to JavaScript and copy template files to dist/
- `pnpm dev -- <args>`: Run CLI directly from TypeScript source using tsx
- `pnpm start -- <args>`: Run compiled JavaScript from dist/
- `pnpm link --global`: Create global symlink for local testing
- `pnpm test`: Run test suite (once tests are implemented)

## Coding Style & Naming Conventions
- Follow the TypeScript 5.x and ES2022 guidelines from `.github/instructions/typescript-5-es2022.instructions.md`
- Use 2-space indentation (standard for TypeScript projects)
- Prefer explicit types on public function signatures
- Use `async/await` for asynchronous operations
- Prefer named exports over default exports
- Keep modules cohesive (`provision.ts` for provisioning, `agentDispatch.ts` for dispatch logic, etc.)
- When adding new CLI commands, register them in `cli.ts` with appropriate options and handlers

## Testing Guidelines
- Use Vitest or Jest for testing framework (to be added)
- Name test files `*.test.ts` or `*.spec.ts`
- Structure tests alongside the modules they cover in a `tests/` or `__tests__/` directory
- Mock file system operations and subprocess calls in tests
- Ensure tests pass via `pnpm test` before opening a PR

## Commit & Pull Request Guidelines
- Write commits in the imperative mood (e.g., `Add Azure retry helper`)
- Reference related issues in commit bodies or PR descriptions when applicable
- PRs should summarize behavior changes, note testing performed, and include relevant context
- Keep commits focused and atomic when possible

## Configuration & Secrets
- Use environment variables or VS Code settings for configuration (no secrets in code)
- API keys and credentials must never appear in config files or Git history
- Template files in `src/vscode/subagent_template/` should remain generic and not contain user-specific data

## Dependencies & Package Management
- Use pnpm for package management (pnpm 9+ recommended)
- Keep dependencies minimal and well-justified
- Prefer stable, well-maintained packages
- Document any platform-specific dependencies or requirements
- pnpm provides faster installs, better disk space efficiency, and strict dependency resolution

## TypeScript Configuration
- Target ES2022 for modern JavaScript features
- Enable strict mode for type safety
- Module resolution: Node with ESM imports
- Output directory: `dist/`
- Include source maps for debugging

## Template File Handling
- Template files must be copied to `dist/vscode/subagent_template/` during build
- Use the `cpx` package in the build script to ensure templates are bundled
- The `DEFAULT_TEMPLATE_DIR` constant in `constants.ts` must resolve to the correct location

<!-- OPENSPEC:START -->
# OpenSpec Instructions

These instructions are for AI assistants working in this project.

Always open `@/openspec/AGENTS.md` when the request:
- Mentions planning or proposals (words like proposal, spec, change, plan)
- Introduces new capabilities, breaking changes, architecture shifts, or big performance/security work
- Sounds ambiguous and you need the authoritative spec before coding

Use `@/openspec/AGENTS.md` to learn:
- How to create and apply change proposals
- Spec format and conventions
- Project structure and guidelines

Keep this managed block so 'openspec update' can refresh the instructions.

<!-- OPENSPEC:END -->